Contains code by Robert Burrell Donkin http://robertburrelldonkin.name